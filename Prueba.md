- 
- Consulta
	- ``` sql
	  --CuadreMigracionCierre
	  ----A NIVEL TOTALES (SEGUROS+EPS+DRIVER)
	   
	  SELECT id_poliza 'SEGUROS', SUM(MONTO_SOL) AS MONTO
	    FROM FT_RTCONTABLE A 
	   WHERE ID_MES = '202204'
	     AND ID_REVISION  NOT IN ('6002001001', '6003001001', '6101001001')
	     AND A.ID_ORIGEN <> '14'
	   UNION
	   SELECT id_poliza 'EPS', SUM(MONTO_SOL) AS MONTO
	    FROM FT_RTCONTABLE_EPS B 
	   WHERE ID_MES = '202204'
	     AND ID_REVISION IN ('6002001001', '6003001001', '6101001001')
	     AND B.ID_ORIGEN <> '14'
	  UNION
	  SELECT id_poliza 'DRIVER', SUM(MONTO) AS MONTO
	    FROM SM_RTDISTRIB_DRIVER_TMP C
	   WHERE ID_MES = '202204'
	  /*   and codcia = '01'*/ 
	  
	  ;
	  ----A NIVEL DE SEGUROS
	  
	  SELECT id_poliza 'SEGUROS',TO_CHAR(A.DISTRIBUCION), SUM(MONTO_SOL) AS MONTO
	    FROM FT_RTCONTABLE A 
	   WHERE ID_MES = '202204'
	     AND ID_REVISION  NOT IN ('6002001001', '6003001001', '6101001001')
	     AND A.ID_ORIGEN <> 14
	   GROUP BY A.DISTRIBUCION
	  UNION
	  SELECT id_poliza 'DRIVER',TO_CHAR(C.DISTRIBUCION), SUM(MONTO) AS MONTO
	    FROM Sm_Rtdistrib_Driver_Tmp C
	   WHERE ID_MES = '202204'
	     and codcia = '01' 
	   GROUP BY C.DISTRIBUCION
	  
	  ;
	  ----A NIVEL DE EPS
	     SELECT id_poliza 'EPS',TO_CHAR(B.DISTRIBUCION), SUM(MONTO_SOL) AS MONTO
	      FROM FT_RTCONTABLE_EPS B 
	     WHERE ID_MES = '202204'
	       AND ID_REVISION IN ('6002001001', '6003001001', '6101001001')
	       AND B.ID_ORIGEN <> 14
	     GROUP BY B.DISTRIBUCION
	    UNION
	     SELECT id_poliza 'DRIVER',TO_CHAR(C.DISTRIBUCION), SUM(MONTO) AS MONTO
	      FROM SM_RTDISTRIB_DRIVER_TMP C
	     WHERE ID_MES = '202204'
	       and codcia = '02'
	     GROUP BY C.DISTRIBUCION
	  
	  ;
	  ---- A 6 DIGITOS
	  
	  SELECT id_poliza 'SEGUROS',TO_NUMBER(A.ID_CUENTA) AS CUENTA,SUBSTR(A.ID_CUENTA,1,6) AS CUENTA6D,A.DISTRIBUCION, SUM(MONTO_SOL) AS MONTO
	    FROM FT_RTCONTABLE A 
	   WHERE ID_MES = '202204'
	     AND ID_REVISION  NOT IN ('6002001001', '6003001001', '6101001001')
	     --AND SUBSTR(A.ID_CUENTA,1,6)='420121'
	     AND A.ID_ORIGEN <> 14
	   GROUP BY A.ID_CUENTA,A.DISTRIBUCION
	  UNION
	  SELECT id_poliza 'DRIVER',TO_NUMBER(C.ID_CUENTA) AS CUENTA,SUBSTR(C.ID_CUENTA,1,6) AS CUENTA6D, C.DISTRIBUCION,SUM(MONTO) AS MONTO
	    FROM Sm_Rtdistrib_Driver_Tmp C
	   WHERE ID_MES = '202204'
	     and codcia = '01' 
	     --AND SUBSTR(C.ID_CUENTA,1,6)='420121'
	   GROUP BY C.ID_CUENTA,C.DISTRIBUCION
	  
	  
	  
	  
	  ------SEGUROS A NIVEL CUENTA
	  
	  SELECT id_poliza CUENTA,SUM(MONTO) FROM (
	  SELECT id_poliza CUENTA,MONTO FROM (
	  SELECT id_poliza SUBSTR(A.ID_CUENTA,1,6) AS CUENTA, SUM(MONTO_SOL) AS MONTO
	    FROM FT_RTCONTABLE A 
	   WHERE ID_MES = '202110'
	     AND ID_REVISION  NOT IN ('6002001001', '6003001001', '6101001001')
	     AND SUBSTR(ID_CUENTA,1,6)='420121'
	        AND A.ID_ORIGEN <> 14
	   GROUP BY SUBSTR(A.ID_CUENTA,1,6)
	  UNION
	  SELECT id_poliza SUBSTR(ID_CUENTA,1,6) AS CUENTA, SUM(MONTO) AS MONTO
	    FROM SM_RTDISTRIB_DRIVER_TMP B
	   WHERE ID_MES = '202110'
	     and codcia = '01' 
	   GROUP BY SUBSTR(ID_CUENTA,1,6)))
	   GROUP BY CUENTA;
	   
	  --SEGUROS A NIVEL CUENTA+RAMO
	  
	  SELECT id_poliza CUENTA,RAMO,PRODUCTO,SUM(MONTO) FROM (
	  SELECT id_poliza CUENTA,RAMO,PRODUCTO,MONTO FROM (
	  SELECT id_poliza TO_NUMBER(SUBSTR(ID_CUENTA,1,6)) AS CUENTA,B.ID_RAMOERP AS RAMO, A.ID_PRODUCTO PRODUCTO, SUM(MONTO_SOL) AS MONTO
	    FROM FT_RTCONTABLE A JOIN MA_RAMO B
	    ON A.ID_TECNICO=B.ID_TECNICO (+)
	      AND B.CODCIA='01'
	  
	   WHERE ID_MES = '202204'
	         AND A.ID_ORIGEN <> 14
	     AND SUBSTR(ID_CUENTA,1,6)='520201'
	     AND ID_REVISION  NOT IN ('6002001001', '6003001001', '6101001001')
	   GROUP BY ID_CUENTA,B.ID_RAMOERP, A.ID_PRODUCTO 
	  UNION
	  SELECT id_poliza TO_NUMBER(SUBSTR(ID_CUENTA,1,6)) AS CUENTA, C.RAMO,C.PRODUCTO,SUM(MONTO) AS MONTO
	    FROM SM_RTDISTRIB_DRIVER_TMP C
	   WHERE ID_MES = '202204'
	     AND CODCIA = '01' 
	     AND SUBSTR(ID_CUENTA,1,6)='520201'
	   GROUP BY ID_CUENTA,C.RAMO, C.PRODUCTO))
	   GROUP BY CUENTA,RAMO;
	   
	   ----
	   
	  --SEGUROS A NIVEL CUENTA+RAMO+PRODUCTO + Distribucion
	  
	  SELECT id_poliza CUENTA,distribucion,RAMO,PRODUCTO,SUM(MONTO) FROM (
	  SELECT id_poliza CUENTA,distribucion, RAMO,PRODUCTO,MONTO FROM (
	  SELECT id_poliza to_number(SUBSTR(ID_CUENTA,1,6)) AS CUENTA,a.distribucion, C.ID_RAMOERP AS RAMO, D.ID_PRODUCTOERP AS PRODUCTO,SUM(MONTO_SOL) AS MONTO
	    FROM Ft_Rtcontable A, (select id_poliza *
	            from ma_ramo r
	           where r.unico_v = 1
	             and r.codcia = '01') c,
	             (select id_poliza *
	            from ma_producto p
	           where p.unica_v = 1
	             and p.codcia = '01') d
	    WHERE A.ID_TECNICO=C.ID_TECNICO (+)
	     and substr(a.id_revision,1,4) = d.id_producto (+)
	      AND C.CODCIA='01'
	   AND ID_MES = '202204'
	         AND A.ID_ORIGEN <> 14
	     AND SUBSTR(ID_CUENTA,1,6)='520201'
	     AND ID_REVISION  NOT IN ('6002001001', '6003001001', '6101001001')
	   GROUP BY ID_CUENTA,a.distribucion, C.ID_RAMOERP,D.ID_PRODUCTOERP
	  UNION
	  SELECT id_poliza TO_NUMBER(SUBSTR(ID_CUENTA,1,6)) AS CUENTA, c.distribucion, C.RAMO,C.PRODUCTO,SUM(MONTO) AS MONTO
	    FROM SM_RTDISTRIB_DRIVER_TMP C
	   WHERE ID_MES = '202204'
	     and codcia = '01' 
	     AND SUBSTR(ID_CUENTA,1,6)='520201'
	   GROUP BY ID_CUENTA,c.distribucion,C.RAMO,C.PRODUCTO))
	   GROUP BY CUENTA,distribucion,RAMO,PRODUCTO;
	   
	   --SEGUROS A NIVEL CUENTA+RAMO (10D)
	  
	  SELECT id_poliza CUENTA,SUM(MONTO) FROM (
	  SELECT id_poliza CUENTA,SUM(MONTO) FROM (
	  SELECT id_poliza TO_CHAR(ID_CUENTA) AS CUENTA,SUM(MONTO_SOL) AS MONTO
	    FROM Ft_Rtcontable A
	   WHERE ID_MES = '202109'
	   AND A.ID_ORIGEN <> 14
	     AND SUBSTR(ID_CUENTA,1,6)='430121'
	     AND ID_REVISION  NOT IN ('6002001001', '6003001001', '6101001001')
	   GROUP BY ID_CUENTA
	  UNION
	  SELECT id_poliza ID_CUENTA,SUM(MONTO)
	    FROM SM_RTDISTRIB_DRIVER_TMP C
	   WHERE ID_MES = '202109'
	     and codcia = '01' 
	     AND SUBSTR(ID_CUENTA,1,6)='430121'
	   GROUP BY CUENTA))
	   GROUP BY CUENTA;
	   
	  ------EPS A NIVEL CUENTA
	  
	  SELECT id_poliza CUENTA,SUM(MONTO) FROM (
	  SELECT id_poliza CUENTA,MONTO FROM (
	  SELECT id_poliza SUBSTR(ID_CUENTA,1,4) AS CUENTA, SUM(MONTO_SOL) AS MONTO
	    FROM DS9_FT_RTCONTABLE_EPS A 
	   WHERE ID_MES = '202008'
	   AND SUBSTR(A.ID_CUENTA,1,6)='400701'
	     AND ID_REVISION IN ('6002001001', '6003001001', '6101001001')
	   GROUP BY SUBSTR(ID_CUENTA,1,4)
	  UNION
	  SELECT id_poliza SUBSTR(ID_CUENTA,1,4) AS CUENTA, SUM(MONTO) AS MONTO
	    FROM DS9_SM_RTDISTRIB_DRIVER_HIS B
	   WHERE ID_MES = '202008'
	     and codcia = '02' 
	    AND SUBSTR(B.ID_CUENTA,1,6)='400701'
	   GROUP BY SUBSTR(ID_CUENTA,1,4)))
	   GROUP BY CUENTA;
	   
	  --EPS A NIVEL CUENTA+RAMO
	  
	  SELECT id_poliza ID_CUENTA,RAMO,SUM(MONTO) FROM (
	  SELECT id_poliza ID_CUENTA,RAMO,MONTO FROM (
	  SELECT id_poliza ID_CUENTA,B.ID_RAMOERP AS RAMO, SUM(MONTO_SOL) AS MONTO
	    FROM DS9_Ft_Rtcontable_Eps A LEFT JOIN MA_RAMO B
	    ON A.ID_TECNICO=B.ID_TECNICO
	    AND B.CODCIA='02'
	   WHERE ID_MES = '201912'
	     AND SUBSTR(ID_CUENTA,1,6)='400701'
	     AND ID_REVISION  IN ('6002001001', '6003001001', '6101001001')
	   GROUP BY ID_CUENTA,B.ID_RAMOERP
	  UNION
	  SELECT id_poliza TO_NUMBER(ID_CUENTA), C.RAMO,SUM(MONTO) AS MONTO
	    FROM DS9_SM_RTDISTRIB_DRIVER_HIS C
	   WHERE ID_MES = '201912'
	     and codcia = '02' 
	     AND SUBSTR(ID_CUENTA,1,6)='400701'
	   GROUP BY ID_CUENTA,C.RAMO))
	   GROUP BY ID_CUENTA,RAMO;
	   
	   
	  SELECT id_poliza *
	    FROM Ft_Rtcontable_Eps A LEFT JOIN MA_RAMO B
	    ON A.ID_TECNICO=B.ID_TECNICO
	   WHERE ID_MES = '201912'
	     AND SUBSTR(ID_CUENTA,1,4)='5501'
	     AND ID_REVISION  IN ('6002001001', '6003001001', '6101001001')
	   
	   
	   -----SELECT id_poliza * FROM DS9_SM_RTDISTRIB_DRIVER_HIS
	  ------SEGUROS A NIVEL CUENTA
	  
	  SELECT id_poliza TABLA,CUENTA,ORIGEN,DISTRIBUCION,ID_TECNICO,ID_PRODUCTO,SUM(MONTO) FROM (
	  SELECT id_poliza 'FT'AS TABLA,SUBSTR(ID_CUENTA,1,6) AS CUENTA, TO_CHAR(ID_ORIGEN) AS ORIGEN,DISTRIBUCION,ID_TECNICO,ID_PRODUCTO,MONTO_SOL AS MONTO
	    FROM DS9_FT_RTCONTABLE A 
	   WHERE ID_MES = '202008'
	   AND SUBSTR(ID_CUENTA,1,6)='430101'
	   AND ID_ORIGEN='13'
	   AND DISTRIBUCION='PROV BONO'
	    AND ID_REVISION  NOT IN ('6002001001', '6003001001', '6101001001')
	  UNION ALL
	  SELECT id_poliza 'FT_EPS' AS TABLA,SUBSTR(ID_CUENTA,1,6) AS CUENTA, TO_CHAR(ID_ORIGEN) AS ORIGEN,DISTRIBUCION,ID_TECNICO,ID_PRODUCTO,MONTO_SOL AS MONTO
	    FROM DS9_FT_RTCONTABLE_EPS A 
	   WHERE ID_MES = '202008'
	     AND ID_REVISION IN ('6002001001', '6003001001', '6101001001')
	  AND SUBSTR(ID_CUENTA,1,6)='430101'   
	   AND ID_ORIGEN='13'
	    AND DISTRIBUCION='PROV BONO'
	     UNION ALL
	  SELECT id_poliza 'DRIVER'AS TABLA,SUBSTR(ID_CUENTA,1,6) AS CUENTA, ORIGEN,DISTRIBUCION,ID_TECNICO,ID_PRODUCTO,MONTO AS MONTO
	    FROM DS9_SM_RTDISTRIB_DRIVER_HIS B
	   WHERE ID_MES = '202008'
	    AND ORIGEN='13'
	   AND SUBSTR(ID_CUENTA,1,6)='430101'
	    AND DISTRIBUCION='PROV BONO')
	   GROUP BY TABLA,CUENTA,ORIGEN,DISTRIBUCION,ID_TECNICO,ID_PRODUCTO;
	   ----
	   SELECT id_poliza SUBSTR(ID_CUENTA,1,6) AS CUENTA, TO_CHAR(ID_ORIGEN) AS ORIGEN,DISTRIBUCION,ID_TECNICO,ID_PRODUCTO,SUM(MONTO_SOL) AS MONTO
	    FROM FT_RTCONTABLE A 
	   WHERE ID_MES = '202008'
	   AND SUBSTR(ID_CUENTA,1,6)='430101'
	     AND ID_ORIGEN='13'
	      AND DISTRIBUCION='PROV BONO'
	   GROUP BY SUBSTR(ID_CUENTA,1,6),ID_ORIGEN,DISTRIBUCION,ID_TECNICO,ID_PRODUCTO;
	   
	   
	  -----CUADRE LOG
	  ---CUADRE DRIVER
	  ---SEGUROS
	  SELECT id_poliza 'SEGUROS',SUM(MONTO_SOL)
	    FROM ds9_FT_RTCONTABLE
	   WHERE ID_MES = '202008'
	     AND id_revision NOT IN ('6002001001', '6003001001', '6101001001')
	  UNION
	  -------EPS
	  SELECT id_poliza 'EPS',SUM(MONTO_SOL)
	    FROM ds9_FT_RTCONTABLE_EPS
	   WHERE ID_MES = '202008'
	     AND id_revision IN ('6002001001', '6003001001', '6101001001')
	  UNION   
	  --LOG
	  SELECT id_poliza 'LOG',SUM(MONTO)
	    FROM ds9_LOG_DETERROR
	   WHERE PERIODO = '202008'
	     AND IDCABEJECUCION = '3467'
	     AND NROEJECUCION in (60,60)--cambiar
	     AND IDTIPOERROR = 8;
	     
	  
	  ----EXTRAE DATA LOG
	    SELECT id_poliza *
	      FROM ds9_LOG_DETERROR
	     WHERE PERIODO = '202008'
	       AND IDTIPOERROR = 8
	          AND IDCABEJECUCION = '3467'
	       AND NROEJECUCION in (59,59);--cambiar
	  
	  -----revisar el cabejecucion 
	  
	  select id_poliza 1 ID,
	  (SELECT id_poliza MAX(IDCABEJECUCION) FROM ds9_LOG_CABEJECUCION WHERE PERIODO = '202008' 
	  AND DESCRIPPROCESO = 'Resultado Tecnico') IDCABEJECUCION, 
	  (SELECT id_poliza NVL(MAX(NROEJECUCION),0) FROM ds9_LOG_DETEJECUCION WHERE PROCESO = 'PROC6' 
	   AND IDCABEJECUCION = (select id_poliza max(IDCABEJECUCION) FROM ds9_LOG_CABEJECUCION WHERE 
	  PERIODO = '202008' AND DESCRIPPROCESO = 'Resultado Tecnico')) NROEJECUCION,
	  'PROC6' PROCESO,
	  'Distribución Driver' DESCRIPPROCESO
	  from dual
	  
	  ```
# estamos en la siguiente cosa que ver 